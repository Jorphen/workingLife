<!DOCTYYPE HTML>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	 <script>
        function a(d, c, e) {
            if (d.addEventListener) {
                d.addEventListener(c, e, false)
            } else {
                d.attachEvent('on' + c, e)
            }
        };
        function b() {
            var c = document.documentElement.clientWidth || document.body.clientWidth;
            document.documentElement.style.fontSize = c / 7.5 + 'px'
        };
        b();
        a(window, 'resize', b)
    </script>
	<link href="css/style.css" type="text/css" rel="stylesheet">
	<link href="css/public.css" type="text/css" rel="stylesheet">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/MUI.js"></script>
	<title>51劳动节小游戏</title>
	<style>
	   
    
	</style>
</head>
<body>
     <article class="page page1 animate" id="page1">
	       <div class="s1-buiding-grey">
		        <img src="imgs/scene1/building01.png">
		   </div>
           <div class="s1-buiding-face flash animate infinite">
		        <img src="imgs/scene1/building02.png">
		   </div>
           <div class="s1-workplace">
                <img src="imgs/scene1/s1-workplace.png">
           </div>
		   <div class="s1-walkers">
                <img src="imgs/scene1/walking.png" class='walkers'>
           </div>
           <div class="s1-trunk">
                <img src="imgs/scene1/trunk.png">
           </div>	
           <div class="s1-crane">
                <img src="imgs/scene1/wajueji.png">
           </div>
           <div class="s1-towerCrane01">
		        <img src="imgs/scene1/dt2.png">
		   </div>
           <div class="s1-hero">
		        <img src="imgs/scene1/worker.png">
		   </div>
           <div class="s1-wall">
		        <img src="imgs/scene1/wall.png">
		   </div>
           <div class="s1-guidBtn">
		        <img src="imgs/scene1/rule.png">
		   </div>
           <div class="s1-startBtn">
		        <img src="imgs/scene1/beginBtn.png">
		   </div>
           <div class='s1-hang1'>
		        <img src="imgs/scene1/bigHang.png">
		   </div>
           	<div class='s1-hang2'>
		        <img src="imgs/scene1/dt1.png">
				<img src="imgs/scene1/bigHang01.png" class='bigHang2'>
		   </div>
		   <div class='s1-title'>
                <img src="imgs/scene1/title.png">
           </div> 
           <div class='s1-challenge'>
                <img src="imgs/scene1/challenge.png">
           </div>   
	 </article>
	 <article class="page page2 animated animate" id="page2">
	       <div class="s2-word01 animated" id='s2-word01'>
		         <img src="imgs/scene2/word01.png">
		   </div>
		   <div class="s2-word02 animated" id='s2-word02'>
		         <img src="imgs/scene2/word02.png">
		   </div>
		   <div class="s2-word03 animated" id='s2-word03'>
		         <img src="imgs/scene2/word03.png">
		   </div>
		   <div class="s2-word04 animated" id='s2-word04'>
		         <img src="imgs/scene2/word04.png">
		   </div>
		   <div class="s2-word05 animated" id='s2-word05'>
		         <img src="imgs/scene2/word05.png">
		   </div>
		   <div class="s2-word06 animated" id='s2-word06'>
		         <img src="imgs/scene2/word06.png">
		   </div>
	 </article>
	 <article class="page page3 animated animate" id="page3">
	       <div class="s3-structure">
		        <img src="imgs/scene3/s3-struction01.png">
		   </div>
		   <div class="s3-btn">
		        <img src="imgs/scene3/goBtn.png">
		   </div>
	 </article>
	 <article class="page page4 animated animate" id="page4">
	       <div class="s4-word01">
		        <img src="imgs/scene4/word01.png">
		   </div>
		   <div class="s4-word02" id='start-buildding'>
		        <img src="imgs/scene4/word02.png">
		   </div>
	 </article>
	 <article class="page page5 animated animate" id="page5">
	       <div class="s5-topLayer">
		        <img src="imgs/scene5/top-choicesLayer.png">
		   </div>
	       <div class="s5-topbar">
		        <img src="imgs/scene5/top-choices.png">
		   </div>		   
           <ul class="s5-stuffs s5-stuffs01" id="stuffInner">
		         <li><img src="imgs/level2/5.png" data-tag="5"></li>
				 <li><img src="imgs/level2/20.png" data-tag="20"></li>
				 <li><img src="imgs/level2/18.png" data-tag="18"></li>
				 <li><img src="imgs/level2/2.png" data-tag="2"></li>
				 <li><img src="imgs/level2/15.png" data-tag="15"></li>
				 <li><img src="imgs/level2/17.png" data-tag="17"></li>
				 <li><img src="imgs/level2/10.png" data-tag="10"></li>
				 <li><img src="imgs/level2/8.png" data-tag="8"></li>
				 <li><img src="imgs/level2/7.png" data-tag="7"></li>
				 <li><img src="imgs/level2/12.png" data-tag="12"></li>
				 <li><img src="imgs/level2/1.png" data-tag="1"></li>
				 <li><img src="imgs/level2/16.png" data-tag="16"></li>
				 <li><img src="imgs/level2/19.png" data-tag="19"></li>
				 <li><img src="imgs/level2/3.png" data-tag="3"></li>
				 <li><img src="imgs/level2/4.png" data-tag="4"></li>
				 <li><img src="imgs/level2/6.png" data-tag="6"></li>
				 <li><img src="imgs/level2/9.png" data-tag="9"></li>
				 <li><img src="imgs/level2/13.png" data-tag="13"></li>
				 <li><img src="imgs/level2/14.png" data-tag="14"></li>
				 <li><img src="imgs/level2/11.png" data-tag="11"></li>
			</ul> 
           <ul class="s5-stuffs s5-stuffs02" id="stuffOuter">
		         <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
				 <li></li>
			</ul>
           <div class="s5-fallStuff"></div>
		   <div class='success-page hide' id='successPage'>
		         <img src='imgs/success/stuck1.png'>
				 <div class='success-btn'>
				       <img src='imgs/success/next.png'>
					   <img src='imgs/success/check.png' class='hide' />
				 </div>
		   </div>
		   <div class='fail-page hide'>
		         <img src='imgs/fail/stuck01.png'>
			     <img src='imgs/fail/repeat.png' class='hide' id='gameAgin'/>
		   </div>
		   <div id='stuck-timer'></div>
	 </article>
	 <div class="coverLayer animated" id='cover'></div>
    <!--	
	<div class='s5-flowers hide' id='flowers'>
		        <img src='imgs/level2/bottomBg.png'>
     </div>
	 -->
<script>
var W = function(a, b, c) {
                c = c && c.style
				c.webkitTransitionTimingFunction = c.MozTransitionTimingFunction = c.msTransitionTimingFunction = c.OTransitionTimingFunction = c.transitionTimingFunction ='ease',
                c.webkitTransitionDuration = c.MozTransitionDuration = c.msTransitionDuration = c.OTransitionDuration = c.transitionDuration = b + "ms",
                c.webkitTransform = "translate(0px," + a + "px)" + "translateZ(0)",
                c.msTransform = c.MozTransform = c.OTransform = "translateY(" + a + "px)"
        };
</script>
<script>
 var walkers = document.getElementsByClassName('walkers')[0];
 var walkTimer = setInterval(function(){
              /walking01/.test(walkers.src) ? (walkers.src = 'imgs/scene1/walking.png') : (walkers.src = 'imgs/scene1/walking01.png');
 },300)
</script>
<script>
	var rootSize = parseInt(getStyles(document.documentElement,'fontSize'));
    var score = 0;
    var choose_status = false;
	var fallStuff = function (){};//掉落物品类;
	var collision = function (){};//碰撞类
   document.body.addEventListener('touchstart',function(b){b.preventDefault()},!1);
   var sources_1=[
	   {
		   src: 'imgs/scene5/s5-choice01.png',
		   tag:'imgs/scene5/fall-1.png',
	       width:.63,
		   height:6.67,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice02.png',
		   tag:'imgs/scene5/fall-2.png',
		   width:.60,
		   height:.56,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice03.png',
		   tag:'imgs/scene5/fall-3.png',
		   width:.2,
		   height:6.37,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice04.png',
		   tag:'imgs/scene5/fall-4.png',
		   width:3.87,
		   height:.86,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice05.png',
		   tag:'imgs/scene5/fall-5.png',
		   width:.6,
		   height:.5,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice06.png',
		   tag:'imgs/scene5/fall-6.png',
		   width:.2,
		   height:6.37,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice07.png',
		   tag:'imgs/scene5/fall-7.png',
		   width:.61,
		   height:6.33,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice08.png',
		   tag:'imgs/scene5/fall-8.png',
		   width:.69,
		   height:6.33,
		   level:1
	   },
	   {
		   src: 'imgs/scene5/s5-choice09.png',
		   tag:'imgs/scene5/fall-9.png',
		   width:3.73,
		   height:7.39,
		   level:0
	   }
   ];
	var sources_2 = [
		{
			src: 'imgs/level2/1.png',
			tag:'imgs/level2/1.png',
			width:2.51,
			height:2.24,
			level : 1
		},
		{
			src: 'imgs/level2/2.png',
			tag:'imgs/level2/2.png',
			width:2.53,
			height:1.78,
			level : 1
		},
		{
			src: 'imgs/level2/3.png',
			tag:'imgs/level2/3.png',
			width:3.01,
			height:1.22,
			level : 0
		},
		{
			src: 'imgs/level2/4.png',
			tag:'imgs/level2/4.png',
			width:.94,
			height:1.08,
			level : 2
		},
		{
			src: 'imgs/level2/5.png',
			tag:'imgs/level2/5.png',
			width:3.51,
			height:1.77,
			level : 2
		},
		{
			src: 'imgs/level2/6.png',
			tag:'imgs/level2/6.png',
			width:.97,
			height:1.03,
			level : 4
		},
		{
			src: 'imgs/level2/7.png',
			tag:'imgs/level2/7.png',
			width:1.38,
			height:1.0,
			level : 2
		},
		{
			src: 'imgs/level2/8.png',
			tag:'imgs/level2/8.png',
			width:3.87,
			height:1.99,
			level : 1
		},
		{
			src: 'imgs/level2/9.png',
			tag:'imgs/level2/9.png',
			width:1.82,
			height:1.51,
			level : 2
		},
		{
			src: 'imgs/level2/10.png',
			tag:'imgs/level2/10.png',
			width:3.85,
			height:1.99,
			level : 1
		},
		{
			src: 'imgs/level2/11.png',
			tag:'imgs/level2/11.png',
			width:1.03,
			height:.98,
			level : 3
		},
		{
			src: 'imgs/level2/12.png',
			tag:'imgs/level2/12.png',
			width:1.56,
			height:.95,
			level : 3
		},
		{
			src: 'imgs/level2/13.png',
			tag:'imgs/level2/13.png',
			width:1.57,
			height:.97,
			level : 3
		},
		{
			src: 'imgs/level2/14.png',
			tag:'imgs/level2/14.png',
			width:1.71,
			height:1.16,
			level : 3
		},
		{
			src: 'imgs/level2/15.png',
			tag:'imgs/level2/15.png',
			width:1.13,
			height:.58,
			level : 4
		},
		{
			src: 'imgs/level2/16.png',
			tag:'imgs/level2/16.png',
			width:1.05,
			height:1.57,
			level : 2
		},
		{
			src: 'imgs/level2/17.png',
			tag:'imgs/level2/17.png',
			width:1.42,
			height:.63,
			level : 3
		},
		{
			src: 'imgs/level2/18.png',
			tag:'imgs/level2/18.png',
			width:.91,
			height:.60,
			level : 5
		},
		{
			src: 'imgs/level2/19.png',
			tag:'imgs/level2/19.png',
			width:.91,
			height:.59,
			level : 5
		},
		{
			src: 'imgs/level2/20.png',
			tag:'imgs/level2/20.png',
			width:.81,
			height:.50,
			level : 5
		},
		{
			src: 'imgs/level2/21.png',
			tag:'imgs/level2/21.png',
			width:.81,
			height:.51,
			level : 5
		}
	]
	var sources_3 = [
		{
			src: 'imgs/level3/1.png',
			tag:'imgs/level3/1.png',
			width:3.53,
			height:4.46,
			level : 1
		},
		{
			src: 'imgs/level3/2.png',
			tag:'imgs/level3/2.png',
			width:4.22,
			height:.74,
			level : 1
		},
		{
			src: 'imgs/level3/3.png',
			tag:'imgs/level3/3.png',
			width:4.26,
			height:1.54,
			level : 1
		},
		{
			src: 'imgs/level3/4.png',
			tag:'imgs/level3/4.png',
			width:4.27,
			height:.31,
			level : 1
		},
		{
			src: 'imgs/level3/5.png',
			tag:'imgs/level3/5.png',
			width:1.6,
			height:.86,
			level : 1
		},
		{
			src: 'imgs/level3/6.png',
			tag:'imgs/level3/6.png',
			width:1.27,
			height:1.3,
			level : 4
		},
		{
			src: 'imgs/level3/7.png',
			tag:'imgs/level3/7.png',
			width:.87,
			height:.56,
			level : 2
		},
		{
			src: 'imgs/level3/8.png',
			tag:'imgs/level3/8.png',
			width:.63,
			height:.41,
			level : 1
		},
		{
			src: 'imgs/level3/9.png',
			tag:'imgs/level3/9.png',
			width:3.53,
			height:1.08,
			level : 1
		}
	]
   var position_1 = [
   		[{x : 2.72 * rootSize, y : 3.55 * rootSize, empty : 1 },{x : 4.22 * rootSize, y: 3.55 * rootSize,empty : 1}],
	    [{x : 3.49 * rootSize, y : 10.28 * rootSize, empty : 1}],
		[{x : 1.78 * rootSize, y : 3.82 * rootSize, empty : 1}],
	    [{x : 1.86 * rootSize, y : 2.58 * rootSize, empty : 1}],
	    [{x : 1.98 * rootSize, y : 10.31 * rootSize, empty : 1},{x : 2.69 * rootSize, y : 10.31 * rootSize, empty : 1},{x : 4.31 * rootSize, y : 10.31 * rootSize, empty : 1},{x : 5.02 * rootSize, y : 10.31 * rootSize, empty : 1}],
	    [{x : 5.64 * rootSize, y : 3.82 * rootSize, empty : 1}],
	    [{x : 3.5 * rootSize, y : 3.9 * rootSize, empty : 1}],
	    [{x : 1.98 * rootSize, y : 3.62 * rootSize, empty : 1},{x : 4.94 * rootSize, y : 3.62 * rootSize, empty : 1}],
		[{x : 1.93 * rootSize, y : 3.44 * rootSize, empty : 1}]
   ];
	var position_2 = [
		     [{x : 4.35 * rootSize, y : 8.07 * rootSize, empty : 1}], //
		     [{x : 4.35 * rootSize, y : 6.33 * rootSize, empty : 1}],  //
		     [{x : 3.55 * rootSize, y : 5.07 * rootSize, empty : 1}],
		     [{x : 3.75 * rootSize, y : 4.6 * rootSize, empty : 1}],
		     [{x : .87 * rootSize, y : 4.12 * rootSize, empty : 1}],
		     [{x : 2.14 * rootSize, y : 4.84 * rootSize, empty : 1}],
		     [{x : 4.72 * rootSize, y : 5.30 * rootSize, empty : 1}],
		     [{x : .72 * rootSize, y : 5.88 * rootSize, empty : 1}],
		     [{x : 4.52 * rootSize, y : 8.83 * rootSize, empty : 1 }],
		     [{x : .7 * rootSize, y : 7.83 * rootSize, empty : 1}],
		     [{x : 3.03 * rootSize, y : 6.55 * rootSize, empty : 1}],
		     [{x : 1.11 * rootSize, y : 8.56 * rootSize, empty : 1}],
		     [{x : 1.11 * rootSize, y : 6.58 * rootSize, empty : 1}],
		     [{x : 4.6 * rootSize, y : 6.84 * rootSize, empty : 1}],
		     [{x : 2.97 * rootSize, y : 7.25 * rootSize, empty : 1}],
		     [{x : 3.0 * rootSize, y : 8.26 * rootSize, empty : 1}],
		     [{x : 2.83 * rootSize, y : 9.67 * rootSize, empty : 1}],
		     [{x : 1.41 * rootSize, y : 9.01 * rootSize, empty : 1}],
		     [{x : 1.41 * rootSize, y : 7.02 * rootSize, empty : 1}],
		     [{x : 4.62 * rootSize, y : 7.55 * rootSize, empty : 1}]
	];
	var position_3 = [
		[{x : 1.95 * rootSize, y : 3.49 * rootSize, empty : 1 }],
		[{x : 1.62 * rootSize, y : 9.74 * rootSize, empty : 1 }],
		[{x : 1.59 * rootSize, y : 8.28 * rootSize, empty : 1 }],
		[{x : 1.59 * rootSize, y : 7.94 * rootSize, empty : 1 }],
		[{x : 4.26 * rootSize, y : 10.37 * rootSize, empty : 1 },{x : 1.57 * rootSize, y : 10.37 * rootSize, empty : 1 }],
		[{x : 3.12 * rootSize, y : 10.03 * rootSize, empty : 1 }],
		[{x : 5.05 * rootSize, y : 7.41 * rootSize, empty : 1 }],
		[{x : 1.59 * rootSize, y : 7.56 * rootSize, empty : 1 }],
		[{x : 1.96 * rootSize, y : 2.41 * rootSize, empty : 1 }]		
	];
   function getStyles(a,b){
      var c = a.ownerDocument.defaultView.getComputedStyle(a,null);
	  return c ? c.getPropertyValue(b) || c[b] : null;
   };
   (function(a){
       function c(m){
	       var timer = null;
		   this.distance = 0;
	       this.element = m;
		   this.fall = function(){
		        var self =this;
				var m = parseFloat(getStyles(self.element,'top'));
			    var height = this.element.offsetHeight;
		        timer = setInterval(function(){
				     m+=1;
					 self.distance+=1;
                     if(m > (11.235 * rootSize - height)){
						  clearInterval(timer);
						 return;
					 }
				     self.element.style.top = m+'px';
				},16.7);

		   }
		   this.stopFall = function(){
		       clearInterval(timer);
		   }
	   }
	   a.falls = c;
   })(fallStuff);
   (function(a){
	   function c(){
		   var m = [];
		   var n = [];
		   this.init = function(b , d){
			   this.element = b;
			   this.position = d ;
		   }
		   this.crash = function (){
			   this.areaIntersect()
		   }
		   this.distance = function(){
			   return {
				   a : m ,
				   b : n
			   }
		   }
		   this.areaIntersect = function(){
			      var self =this;
			      var disX = [] ,disY = [];
			      [].every.call(self.position , function(val ,index){
                       m[index] = Math.abs(parseFloat(getStyles(self.element,'left'))- val.x);
					   n[index] = Math.abs(parseFloat(getStyles(self.element,'top'))- val.y);
					   return 1;
				  });
		   }
	   }
	   c.call(a);
   })(collision);
    var gameBackgroundImg_sources = [];
	var structure_sources = [];
	var gameEnd_sources = []
	function GamePage(m ,k ,f){   //sources , position;
		 var sources ;
		 var position;
		 var innerCell;
		 var outerCell;
		 var fall_stuff;
		 var members;
		 var game_stuck;
		 var opa; //需要透明化处理的关卡;
		 this.init = function(a , b ,c ,d , e , f){   //a外部按钮,b内部物品,c掉落物品,d成员个数;e游戏关卡;f成员透明度处理与否;
			 outerCell = a;
			 innerCell = b;
			 fall_stuff = c;
			 members = d;
			 sources = m;
			 position = k;
			 game_stuck = e || 1;
			 opa = f ? 1 : !1;
		 }
		 this.createCells = function (){
			  for(var i = 0 ;i< members ; i++){
				  var outer_aLi = document.createElement('li');
				  var inner_aLi = document.createElement('li');
				  var img = document.createElement('img');
				  outer_aLi.index = i;
				  inner_aLi.index = i;
				  outer_aLi.addEventListener('touchstart',A,!1)
				  inner_aLi.appendChild(img);
				  outerCell.appendChild(outer_aLi);
				  innerCell.appendChild(inner_aLi);
			  }
		 }
		 this.clear = function(){
			   while(outerCell.hasChildNodes()){
				   outerCell.removeChild(outerCell.firstChild);
			   }
			   while(innerCell.hasChildNodes()){
				 innerCell.removeChild(innerCell.firstChild);			  
			   }
			   var fall_parent = fall_stuff.parentNode;
			   var fall_class = fall_stuff.className;
			   var all_falls = fall_parent.getElementsByClassName(fall_class);
			   var len = all_falls.length;
			   if(len == 1){
				   return ;
			   }else {
				    while(len !=1){
					    fall_parent.removeChild(all_falls[len-1]);
						len--;
					}
					choose_status =!1;				
			   }
		 }
		 this.innerFills = function(){
              var imgs = innerCell.getElementsByTagName('img');
			  var all_img_sources = [];    //存放所有的图片,也包括重复的图片;
              var len = position.length;
			  var new_sources = [];
			  var a = [];  //存放随机数目;
			  for(var i = 0 ; i < len ; i++){
				  for(var j = 0 ;j < position[i].length ; j++){
					  var detail = {};
					//  all_img_sources.push(sources[i].src);
					  detail.src = sources[i].src;
					  detail.tag = sources[i].tag;
					  detail.width = sources[i].width;
					  detail.height = sources[i].height;
					  detail.mid = i+1;
					  all_img_sources.push(detail);
				  }
			   }
              //all_img_sources组合随机排序得到new_sources新的随机组合;
			   while(a.length < imgs.length){
				     var num = Math.floor(Math.random()*imgs.length);
                     ~a.indexOf(num) || (a.push(num));
			   }

			   for(var i = 0 ;i < a.length ;i++){
				   new_sources[i] = all_img_sources[a[i]];
			   }
			  for(var i = 0 ;i<imgs.length;i++){
				  imgs[i].src = new_sources[i].src;
				  imgs[i].setAttribute('data-tag',String(new_sources[i].mid));
			  }
		 };
		 this.changeBackgroundImg = function (){
		       
		 }
		 function A(b){   //c:掉落物品;
			  if(choose_status) return;
			  choose_status = true;
			 var img = innerCell.getElementsByTagName('li')[this.index].getElementsByTagName('img')[0];
			 var _mid = parseInt(img.getAttribute('data-tag'))-1;
			 var src = sources[parseInt(img.getAttribute('data-tag'))-1].tag;
			 var z_index =  sources[parseInt(img.getAttribute('data-tag'))-1].level || 0;
			 var width = sources[parseInt(img.getAttribute('data-tag'))-1].width * rootSize;
			 var height = sources[parseInt(img.getAttribute('data-tag'))-1].height * rootSize;
			 var initial_distance = 0;
			 var inner_Li =inner.getElementsByTagName('li');
			 var _falls = fall_stuff.cloneNode('true');
			 this.classList.add('animated');
			 this.classList.add('changeWidth');
			 inner_Li[this.index].removeChild(inner_Li[this.index].getElementsByTagName('img')[0]);
			 inner_Li[this.index].classList.add('animated');
			 inner_Li[this.index].classList.add('changeWidth');
			 _falls._mid = _mid;
			 _falls.style.backgroundImage = 'url('+src+')';
			 _falls.style.width = width + 'px';
			 _falls.style.height = height + 'px';			
			 _falls.style.top = 2.05 * rootSize -height + 'px';
			 _falls.style.left = .68 * rootSize + 'px';
			 initial_distance = 2.05 * rootSize -height;
			 fall_stuff.parentNode.appendChild(_falls);
			 fallStuff.falls(_falls);
			 fallStuff.fall();
			 _falls.addEventListener('touchstart',function(){
				 var distance = parseFloat(getStyles(this,'top'))-initial_distance;			
				 if(distance >= parseFloat(getStyles(this,'height'))){
				      if(opa){
							 var allFalls = this.parentNode.getElementsByClassName(this.className);
							 _falls.style.zIndex = 99;
							 for(var i = 1 ; i< allFalls.length - 1 ; i++){
								  allFalls[i].style.opacity = 0.3;
							 }
				     }
					 fallStuff.stopFall();
					 this.isFixed || this.addEventListener('dragstart',Z ,!1);
				 }
			 },!1);
			 _falls.addEventListener('touchend',function(){
				 if(opa){
					 var allFalls = this.parentNode.getElementsByClassName(this.className);
					 for(var i = 1 ; i< allFalls.length - 1 ; i++){
						 allFalls[i].style.opacity = 1;
					 }
				 }
			 },!1)
			 function Z(b){
				 var self = this;
				 var B = b.detail.center.x;
				 var C = b.detail.center.y;
				 var D = parseFloat(getStyles(this,'left'));
				 var E = parseFloat(getStyles(this,'top'));
				 var res;
				 this.addEventListener('drag', N ,!1);
				 this.addEventListener('dragend',J ,!1);
				 function M(){
					 collision.init(self ,position[self._mid]);
					 collision.crash();
					 res = collision.distance() ;
				 };
				 function N(b){
					 if(this.isFixed) return ;
					 var disX = b.detail.center.x - B;
					 var disY = b.detail.center.y - C;
					 var x = D + disX ;
					 var y = E + disY ;
                     x < 20 && (x = 20);
					 x > document.body.clientWidth - 20 - this.offsetWidth && (x = document.body.clientWidth - 20 - this.offsetWidth);
					 y < $('.s5-topbar').height() && (y = $('.s5-topbar').height());
					 y > 11.235 * rootSize - $(this).height() && (y = 11.235 * rootSize - $(this).height());
					 this.style.left = x + 'px';
					 this.style.top = y + 'px';
					 M();
				 }
				 function J(b){
					// this.removeEventListener('drag', N ,!1);
					 var self = this;
					 if(this.isFixed) return;
					 [].every.call(res.a, function(val , index){
						 if(val <= 2/3 * width && (res.b[index] <= 2/5 * height) && position[self._mid][index] && position[self._mid][index].empty){
							 self.style.left = position[self._mid][index].x + 'px';
							 self.style.top = position[self._mid][index].y + 'px';
							 position[self._mid][index].empty = !1;
							 self.isFixed = 1;
							 choose_status = !1;
							 score+=1;
							 self.style.zIndex = z_index;
							 if(score == total){
							     init_timer.end();	
								// slideIn(success_page);
                                 success_bgChange(success_page.getElementsByTagName('img')[0]);
								 success_page.classList.remove('hide');
								 success_btnChange();
                                 stuck+=1;								 
							 }
							 return !1;
						 }
						 return 1;
					 })
				 }
			 }
		 }
		 this.getResult = function(){

		 }
	}
	var page1 = new GamePage(sources_1 , position_1 ,1);
	var page2 = new GamePage(sources_2 , position_2 ,1);
	var page3 = new GamePage(sources_3 , position_3);
	var outer = document.getElementById('stuffOuter');
	var inner = document.getElementById('stuffInner');
	var fall = document.getElementsByClassName('s5-fallStuff')[0];
	page1.init(outer ,inner , fall ,14 ,1 ,1);
	page2.init(outer ,inner , fall ,20 ,2 ,1);
	page3.init(outer ,inner , fall ,10 ,3);
	var level_1 = function(){		
		page1.clear();
		page1.createCells();
		page1.innerFills();
	}
	var level_2 = function(){		
		page2.clear();
		page2.createCells();
		page2.innerFills();
	}
	var level_3 = function(){		
		page3.clear();
		page3.createCells();
		page3.innerFills();
	}
	function begginGame(){
	   switch(stuck){
	        case 1:
		        level_1();
				break;
			case 2:
		        level_2();
				break;
			case 3:
		        level_3();
				break;
	   }
	}
	//level_1();
	var s1 = document.getElementById('page1');
	var s2 = document.getElementById('page2');
	var s3 = document.getElementById('page3');
	var s4 = document.getElementById('page4');
	var s5 = document.getElementById('page5');
	var animationState = !1;
	var stuck = 1; //设置关卡;
	var time_limit = [180,180,180];
	var coverLayer = document.getElementById('cover');
	var s1_btn = document.getElementsByClassName('s1-startBtn')[0];
	var s2_words = document.getElementById('page2').getElementsByTagName('div');
	var struction_pic = document.getElementsByClassName('s3-structure')[0];
	var struction_btn = document.getElementsByClassName('s3-btn')[0];
	var start_buidding = document.getElementById('start-buildding');
	var fail_page = document.getElementsByClassName('fail-page')[0];
	var gameAgin = document.getElementById('gameAgin');
	var total = 0;   //每个关卡总分数
	//var score = 0;  //每个关卡实际得分数;
	var success_page = document.getElementById('successPage');
	s1_btn.addEventListener('touchstart',function(){
	      hide(s1);
		  slideIn(s2);
		  slideOut(cover);	  
		  s2_wordsShow(s2_words);		  
		  setTimeout(function(){
                cover.classList.remove('slideOut');
		        s2.addEventListener('touchstart',function(){
		              cover.classList.add('slideOut');
					  setTimeout(function(){
					      cover.classList.remove('slideOut');
					  },1000)
				     // this.classList.contains('slideIn') && (this.classList.remove('slideIn')) && (this.classList.add('slideOut'));
					  this.classList.remove('slideIn') && (this.classList.add('hide'));
					  s2_wordsHide(s2_words)
					  s3.classList.add('slideIn');
					  struction_PicChange(struction_pic.getElementsByTagName('img')[0])
					  struction_pic.classList.add('active');
					  struction_btn.classList.add('active');
				},!1)
		  },2000)
	},!1);
	struction_btn.addEventListener('touchstart',function(){
	      s4_bgChange(s4);
	      cover.classList.add('slideOut');
	      s3.classList.remove('slideIn');
		  s4.classList.add('slideIn');
		  struction_pic.classList.remove('active');
		  this.classList.remove('active');
		  setTimeout(function(){
		      cover.classList.remove('slideOut');
		  },1000);
		  
	},!1);
	start_buidding.addEventListener('touchstart',function(){
	      s5_bgChange(s5);
		 // stuck == 2 ? (document.getElementById('flowers').classList.remove('hide')) : (document.getElementById('flowers').classList.contains('hide') || document.getElementById('flowers').classList.add('hide'));
		  cover.classList.add('slideOut');
		  this.parentNode.classList.remove('slideIn');		  
		  slideIn(s5);
		  begginGame();
		  init_timer.init();
		  init_timer.beggin();
		  totalScore(stuck);
	},!1);
	gameAgin.addEventListener('touchstart',function(){
	      fail_page.classList.add('hide');
		  slideOut(s5);
		  slideIn(s2);
		  cover.classList.add('slideOut');		  
		  s2_wordsShow(s2_words);		  
		  setTimeout(function(){
                cover.classList.remove('slideOut');
		        s2.addEventListener('touchstart',function(){
		              cover.classList.add('slideOut');
					  setTimeout(function(){
					      cover.classList.remove('slideOut');
					  },1000)
				     // this.classList.contains('slideIn') && (this.classList.remove('slideIn')) && (this.classList.add('slideOut'));
					  this.classList.remove('slideIn') && (this.classList.add('hide'));
					  s2_wordsHide(s2_words)
					  slideIn(s3);
					  struction_PicChange(struction_pic.getElementsByTagName('img')[0])
					  struction_pic.classList.add('active');
					  struction_btn.classList.add('active');					  
				},!1)
		  },2000);
          switch(stuck){
				 case 1:
					 [].every.call(position_1,function(a ,b){
						  [].every.call(a,function(m){
						      m.empty != 1 && (m.empty = 1);
							  return 1;
						  })
						  return 1;
					 })
					 break;
				case 2 :
				    [].every.call(position_1,function(a ,b){
						  [].every.call(a,function(m){
						      m.empty != 1 && (m.empty = 1);
							  return 1;
						  })
						  return 1;
					 });
					 [].every.call(position_2,function(a ,b){
						  [].every.call(a,function(m){
						      m.empty != 1 && (m.empty = 1);
							  return 1;
						  })
						  return 1;
					 });
					 break;
				case 3 :
				    [].every.call(position_1,function(a ,b){
						  [].every.call(a,function(m){
						      m.empty != 1 && (m.empty = 1);
							  return 1;
						  })
						  return 1;
					 });
					 [].every.call(position_2,function(a ,b){
						  [].every.call(a,function(m){
						      m.empty != 1 && (m.empty = 1);
							  return 1;
						  })
						  return 1;
					 });
					 [].every.call(position_3,function(a ,b){
						  [].every.call(a,function(m){
						      m.empty != 1 && (m.empty = 1);
							  return 1;
						  })
						  return 1;
					 });
					 break;
		}
	},!1)
	var s4_bgs = ['imgs/scene4/bg-s4-01.png','imgs/scene4/bg-s4-02.png','imgs/scene4/bg-s4-03.png'];
	var s5_bgs = ['imgs/scene5/bg-s5-1.png','imgs/scene5/bg-s5-2.png','imgs/scene5/bg-s5-3.png'];
	var s5_failPage_bgs = ['imgs/fail/stuck01.png','imgs/fail/stuck02.png','imgs/fail/stuck03.png']
	var struction_src = ['imgs/scene3/s3-struction01.png','imgs/scene3/s3-struction02.png','imgs/scene3/s3-struction03.png'];
	var success_bgs =['imgs/success/stuck1.png','imgs/success/stuck2.png','imgs/success/stuck3.png'];
	var success_btns = document.getElementsByClassName('success-btn')[0].getElementsByTagName('img');
	var success_btns_1 =success_btns[0];
	var success_btns_2 =success_btns[1];
	success_btns_1.addEventListener('touchstart',function(){
	      score=0;
	      success_page.classList.add('hide');		  
		  slideOut(s5);
		  slideIn(s2);
		  s2_wordsShow(s2_words);
	},!1);
	success_btns_2.addEventListener('touchstart',function(){
		 alert('恭喜你通关，耗时：'+(time_result[0]+time_result[1]+time_result[2]).toFixed(2)+' 秒,快和小伙伴们一起参与比赛吧!');
	},!1)
	function s4_bgChange(obj){
	    switch(stuck){
		    case 1:
			      obj.style.backgroundImage = 'url('+s4_bgs[0]+')';
				  break;
			case 2:    
			       obj.style.backgroundImage = 'url('+s4_bgs[1]+')';
				  break;
			case 3:
			      obj.style.backgroundImage= 'url('+s4_bgs[2]+')';
				  break;
		}
	}
	function s5_bgChange(obj){
	    switch(stuck){
		    case 1:
			      obj.style.backgroundImage = 'url('+s5_bgs[0]+')';
				  break;
			case 2:  
			       obj.style.backgroundImage = 'url('+s5_bgs[1]+')';
				  break;
			case 3:
			      obj.style.backgroundImage= 'url('+s5_bgs[2]+')';
				  break;
		}
	}
	function s5_failPge_bgChange(obj){
	    switch(stuck){
		    case 1:
			      obj.src = s5_failPage_bgs[0];
				  break;
			case 2:  
			       obj.src = s5_failPage_bgs[1];
				  break;
			case 3:
			      obj.src= s5_failPage_bgs[2];
				  break;
		}
	};
	function success_bgChange(obj){
	     switch(stuck){
		    case 1:
			      obj.src = success_bgs[0];
				  break;
			case 2:  
			       obj.src = success_bgs[1];
				  break;
			case 3:
			      obj.src= success_bgs[2];
				  break;
		}  
	}
	function success_btnChange(){	      
	      switch(stuck){
		      case 3 :
			      success_btns_1.classList.add('hide')
				  success_btns_2.classList.remove('hide');
				  break;	  
		  }
	}
	function s2_wordsShow(obj){
	     switch (stuck){
		     case 1: 
			       obj[0].classList.add('slideLeft');
				   obj[1].classList.add('slideRight');
				   break;
			case 2: 
			       obj[2].classList.add('slideLeft');
				   obj[3].classList.add('slideRight');
				   break;
			case 3: 
			       obj[4].classList.add('slideLeft');
				   obj[5].classList.add('slideRight');
				   break;
		 }
	}
	function s2_wordsHide(obj){
	     switch (stuck){
		     case 1: 
			       obj[0].classList.remove('slideLeft');
				   obj[1].classList.remove('slideRight');
				   break;
			case 2: 
			       obj[2].classList.remove('slideLeft');
				   obj[3].classList.remove('slideRight');
				   break;
			case 3: 
			       obj[4].classList.remove('slideLeft');
				   obj[5].classList.remove('slideRight');
				   break;
		 }
	}
	function struction_PicChange(obj){
	    switch (stuck){
		     case 1: 
			       obj.src=struction_src[0];
				   break;
			case 2: 
			       obj.src=struction_src[1];
				   break;
			case 3: 
			       obj.src=struction_src[2];
				   break;
		 }
	}
	var stuckTimer = document.getElementById('stuck-timer');
	var time_result=[];
	function timeClass(obj ,fail){
	    var timer;
		var start_time;
		var now_time;
		var obj = obj;	
		this.init = function(){
		        if(stuck == 1){
					start_time = time_limit[0];
				}else if(stuck == 2){
					start_time = time_limit[1];
				}else if(stuck == 3){
					start_time = time_limit[2];
				}
			    now_time = 0;
			    timer = null;
		}
	    this.beggin = function(){
		    timer = setInterval(function(){
			              start_time = (start_time.toFixed(2)-0.01);
						  now_time = start_time.toFixed(2);						  
						  if(now_time==0){
							  now_time = 0;
							  clearInterval(timer);
							  s5_failPge_bgChange(fail.getElementsByTagName('img')[0])
							  fail.classList.remove('hide');
							  stuck =1;
							  score = 0;
							  time_result=[];
						  }
						  obj.innerHTML = now_time +' 秒';
			},10)
		};
		this.end = function(){		     
		     clearInterval(timer);
			 switch(stuck){
			     case 1:
				     time_result.push(time_limit[0]-start_time);
					 break;
				case 2:
				     time_result.push(time_limit[1]-start_time);
					 break;
				case 3:
				     time_result.push(time_limit[2]-start_time);
					 break;
			 };
		};
	};
	function slideIn(obj){
	    obj.classList.contains('slideOut') ? (obj.classList.remove('slideOut'),obj.classList.add('slideIn')) :(obj.classList.add('slideIn'));
	}
	function slideOut(obj){
	    obj.classList.contains('slideIn') ? (obj.classList.remove('slideIn'),obj.classList.add('slideOut')) :(obj.classList.add('slideOut'));
	}
	function hide(obj){
	    if(obj.classList.contains('hide')){
		     return;
		}else{
		    obj.classList.add('hide');
		}
	}
	function show(obj){
	    if(obj.classList.contains('show')){
		     return;
		}else{
		    obj.classList.add('show');
		}
	}
	function totalScore(stuck){
	    switch(stuck){
		    case 1:
			   total = 14;
			   break;
			case 2:
			   total = 20;
			   break;
			case 3:
			   total = 10;
			   break;
		}
	}
	var init_timer = new timeClass(stuckTimer,fail_page);
</script>

</body>
</html>